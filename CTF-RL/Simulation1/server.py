import constants as const

class Msg():
    def __init__(self, command, content):
        self.command = command
        self.content = content

class Server():
    def __init__(self, nport, vulnport):
        self.nport = nport  # Số lượng cổng tổng cộng
        self.vulnport = vulnport  # Cổng dễ bị tấn công
        self.termination = False  # Trạng thái kết thúc game
    
    def step(self, action):
        command = action.command
        
        if (command == const.SCAN):
            msg = Msg(const.OPENPORT, self.vulnport)  # Trả về cổng dễ bị tấn công khi nhận lệnh scan
            return msg, 0, self.termination, 'Discovered open port(s)'
        
        elif (command == const.ATTACK):
            target = action.content
            if (target == self.vulnport):
                self.termination = True
                msg = Msg(const.FLAG, None)  # Trả về cờ khi tấn công đúng cổng dễ bị tấn công
                return msg, 100, self.termination, 'Flag captured'
            else:
                msg = Msg(const.NONE, None)  # Trả về không có gì nếu tấn công sai cổng
                return msg, -1, self.termination, 'Nothing happened'
    
    def reset(self):
        self.termination = False  # Đặt lại trạng thái kết thúc game
        return None, 0, self.termination, '\nGame reset'
